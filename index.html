<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <style></style>
</head>

<body>
    <svg></svg>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
        let width = 1000, height = 600;

        // Data scale
        let dataMap = new Map()

        let svg = d3.select("svg")
            .attr("viewBox", "0 0 " + width + " " + height)

        // color scale
        const colorScale = d3.scaleThreshold()
            .domain([500, 1000, 5000, 10000, 25000, 40000])
            .range(d3.schemeOranges[7]);

        // Load external data
        Promise.all([
            d3.json("sgmap.json"), 
            d3.csv("population2021.csv", 
            function(datapoints) {
                dataMap.set(datapoints.Subzone, +datapoints.population)
        })
        ]).then(data => {

            console.log(data[0]);
            console.log(data[1]);
            console.log(dataMap);

            // Map and projection
            var projection = d3.geoMercator()
                .center([103.851959, 1.290270])
                .fitExtent([[20, 20], [980, 580]], data[0]);

            const path = d3.geoPath();
            let geopath = d3.geoPath().projection(projection);

            svg.append("g")
                .attr("id", "districts")
                .selectAll("path")

                // Topology of Map
                .data(data[0].features)
                .enter()
                .append("path")

                // Draw each country
                .attr("d", geopath)

                // Set the color for map
                .attr("fill", function (d) {
                    d.total = dataMap.get(d.properties.Field_1) || 0;
                    return colorScale(d.total);
                })
        })

    </script>

</body>

</html>